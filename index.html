<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Кликер</title>
</head>
<body>
    <h1>Кликер</h1>
    <p id="counter">0</p>
    <button onclick="handleClick()">Кликни меня</button>

    <!-- Telegram SDK -->
    <script src="https://telegram.org/js/telegram-web-app.js "></script>

    <script>
        const user = window.Telegram.WebApp.initDataUnsafe.user;
        const ws = new WebSocket(`wss://yourserver.com/ws/${user.id}`);

        let count = 0;

        // Получаем текущее значение кликов
        fetch(`https://yourserver.com/user/ ${user.id}`)
            .then(res => res.json())
            .then(data => {
                count = data.total_clicks || 0;
            });

        // Обновляем счётчик
        function handleClick() {
            count++;
            document.getElementById("counter").innerText = count;
            ws.send(JSON.stringify({ type: "click", count: count }));
        }

        // Подключение по WebSocket
        ws.onopen = () => {
            console.log("WebSocket подключён");
        };

        ws.onmessage = (e) => {
            const msg = JSON.parse(e.data);
            if (msg.type === "update") {
                console.log("Сессия закрыта");
            }
        };
    </script>
</body>
</html>
